\section{SV model}
\subsection{Mathematical model}
The latent state transition is
\begin{align*}
\xt = \phi\xtt+\zt\bz+\errX\;,~\errX\sim\NID{0}{\sigma_X^2}\;,
\end{align*}
and the measurement equation is
\begin{align*}
\yt=\errY\;,~\beta_Y\sqrt{\exp\left(\xt\right)}\errY\sim\NID{0}{1}\;.
\end{align*}
This implies
\begin{align*}
%p\left(x_0\right)&=\\
p\left(\xt|\xtt\right)&=\mathcal{N}\left(x_t~\vline~\phi\xtt+\zt\bb_Z,\sigma_X^2\right)\;,t=1,\ldots,T\;,\\
p\left(\yt|\xt\right)&=\mathcal{N}\left(\yt~\vline~0,\beta_Y^2\exp\left(\xt\right)\right)\;,t=1,\ldots,T\;.
\end{align*}
Finally, we need prior assumptions on $\errX$ and $\errY$:
\begin{align*}
\sigma_X^2&\sim\IG{a_{X}}{b_{X}}\;,a_{X}=b_{X}=0.001\;,\\
\beta_Y^2&\sim\IG{a_{Y}}{b_{Y}}\;,a_{Y}=b_{Y}=0.001\;.
\end{align*}
Note that the model can be written in matrix form as:
\begin{align*}
\Xt&=\Xtt\phi + \bs{z}_{2:T}\bz + \ErrX\;,\\
\Xt&=\Zt\times \left(\phi,\bz^{\prime}\right)^{\prime} + \ErrX\;,
\end{align*}
where $\Zt$ is a matrix containing as first column $\Xtt$ and the remaining $K$ regressors in $\bs{z}_{2:T}$.
This makes it easier to calculate the Gibbs block for $\phi$ below.
%
%
%
%
%
\clearpage
\subsection{Gibbs-Part}
To derive $p\left(\ts|x_{0:T},y_{1:T}\right)$, consider the full probabilistic model with $\bs{\theta}=\left(\sigma_X^2,\sigma_Y^2,\phi,\bz\right)$ as
\begin{align*}
p\left(\ts,x_{0:T},y_{1:T}\right)
&=
p\left(y_{1:T}|\ts,x_{0:T}\right)p\left(x_{0:T},\ts\right)
=
\prodt p\left(\yt|\xt,\ts\right)
\prodt p\left(\xt|\xtt,\ts\right)p\left(x_0|\ts\right)p\left(\ts\right)\;,\\
&=
\frac{1}{\left(2\pi\beta_{Y}^2\exp\left(\xt\right)\right)^{T/2}}\prodt \exp \left(-\frac{\yt^2}{2\beta_{Y}^2\exp\left(\xt\right)}\right)\\
&\times
\frac{1}{\left(2\pi\sigma_{X}^2\right)^{T/2}}\prodt \exp \left(-\frac{\left(\xt-\phi\xtt-\zt\bz\right)^2}{2\sigma_X^2}\right)\\
&\times \frac{b_X^{a_X}}{\Gamma\left(a_X\right)}\left(\sigma_X^2\right)^{-a_X-1}\exp\left(-\frac{b_X}{\sigma_X^2}\right)\\
&\times \frac{b_Y^{a_Y}}{\Gamma\left(a_Y\right)}\left(\beta_Y^2\right)^{-a_Y-1}\exp\left(-\frac{b_Y}{\beta_Y^2}\right)\;.
\end{align*}
Then, the conditional parameter distributions are conjugate and given as
\begin{align*}
p\left(\sigma_X^2|x_{0:T},y_{1:T},\sigma_Y^2\right)
&=\frac{1}{\left(2\pi\sigma_{X}^2\right)^{T/2}}\prodt \exp \left(-\frac{\left(\xt-\phi\xtt-\zt\bz\right)^2}{2\sigma_X^2}\right)\\
&\times \frac{b_X^{a_X}}{\Gamma\left(a_X\right)}\left(\sigma_X^2\right)^{-a_X-1}\exp\left(-\frac{b_X}{\sigma_X^2}\right)\\
\\
&\pt \left(\sigma_X^2\right)^{-(a_X+T/2)-1}
\times\exp
\left(
-\frac{1}{\sigma_X^2}
\left(
b_X+\frac{\sumt\left(\xt-\phi\xtt-\zt\bz\right)^2}{2}
\right)
\right)\\
p\left(\beta_Y^2|x_{0:T},y_{1:T},\sigma_X^2\right)
&\pt
\left(\beta_Y^2\right)^{-(a_Y+T/2)-1} 
\times \exp
\left(
-\frac{1}{\beta_Y^2}
\left(
b_Y+\frac{\sumt\exp\left(-\xt\right)\yt^2}{2}
\right)
\right)\;.
\end{align*}
With e.g. $a_Y=a_X=b_Y=b_X=0.001$, we have
\begin{align*}
\sigma_X^2\sim\IG{a^*_X}{b^*_X}\;,~a^*_X&=a_X+T/2\;,~b^*_X=b_X+\frac{\sumt\left(\xt-\phi\xtt-\zt\bz\right)^2}{2}\\
\sigma_Y^2\sim\IG{a^*_Y}{b^*_Y}\;,~a^*_Y&=a_Y+T/2\;,~b^*_Y=b_Y+\frac{\sumt\exp\left(-\xt\right)\yt^2}{2}\;.
\end{align*}
For $\bz^*=\left(\phi,\bz^{\prime}\right)^{\prime}$ with a normal prior $\bz^*\sim\mathcal{N}_{K+1}\left(\underline{\bz^*}, \Ozprior\right)$ and the previous $\Xt=\Zt\bz^* + \ErrX\;,$ we have
\begin{align*}
p\left(\bz^*\given \Xt,\Zt,\sigma_X^2,\sigma_Y^2\right) 
& \pt
\exp\left\lbrace-\frac{1}{2}\left(\Xt-\Zt\bz^*\right)^{\prime}\VCMt^{-1}\left(\Xt-\Zt\bz^*\right)\right\rbrace\\
& \times 
\exp\left\lbrace-\frac{1}{2}\left(\bz-\underline{\bz^*}\right)^{\prime}\Ozprior^{-1}\left(\bz-\underline{\bz^*}\right)\right\rbrace\\
\end{align*}
Because we have
\begin{align*}
\left(\Xt-\Zt\bz^*\right)^{\prime}\VCMt^{-1}\left(\Xt-\Zt\bz^*\right)
& =
\bz^{*\prime}\Zt^{\prime}\VCMt^{-1}\Zt\bz^{*}-2\bz^{*\prime}\Zt^{\prime}\VCMt^{-1}\Xt\\
& + \Xt^{\prime}\VCMt^{-1}\Xt
\\
\left(\bz^*-\underline{\bz^*}\right)^{\prime}\Ozprior^{-1}\left(\bz^*-\underline{\bz^*}\right) 
& = 
\bz^{*\prime}\Ozprior^{-1}\bz^*
-2\bz^{*\prime}\Ozprior^{-1}\underline{\bz^*}\\
& +
\underline{\bz^{*\prime}}*\Ozprior^{-1}\underline{\bz^*}
\end{align*}
we obtain
\begin{align*}
\Rightarrow 
p\left(\bz^*\given \Xt,\Zt,\sigma_X^2,\sigma_Y^2\right)
&=
\mathcal{N}_{K+1}\left(\overline{\bz},\Ozpost\right)\;\\
\Ozpost
& =
\left[\Zt^{\prime}\VCMt^{-1}\Zt+\Ozprior^{-1}\right]^{-1} \\
\overline{\bz}
& =
\Ozpost\times\left[\Zt^{\prime}\VCMt^{-1}\Xt+\Ozprior^{-1}\bz\right]
\end{align*}
%
%
%
%
%
\clearpage
\underline{In Detail:}
%
%
%
%
%
\clearpage
\underline{In Detail:}